#!/bin/bash
# kurbeScript - Setup Minikube and deploy messaging_app

echo "ğŸš€ Starting Minikube..."
minikube start --driver=docker

echo "ğŸ“¦ Setting Docker env to Minikube..."
eval $(minikube docker-env)

echo "ğŸ³ Building messaging_app Docker image..."
docker build -t messaging_app:latest .

echo "ğŸ“‚ Applying Kubernetes manifests..."
kubectl apply -f deployment.yaml
kubectl apply -f kubeservice.yaml
kubectl apply -f ingress.yaml

echo "ğŸŒ Enabling Minikube ingress..."
minikube addons enable ingress

echo "â³ Waiting for pods to be ready..."
kubectl wait --for=condition=available --timeout=120s deployment/messaging-app-deployment

echo "âœ… Deployment complete!"
echo "ğŸ”— Access your app via:"
minikube service messaging-app-service --url
